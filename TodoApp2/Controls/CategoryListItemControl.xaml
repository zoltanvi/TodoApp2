<UserControl
    x:Class="TodoApp2.CategoryListItemControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:TodoApp2"
    x:Name="CategoryListItemUC"
    AutomationProperties.AutomationId="CategoryListItemUC"
    mc:Ignorable="d"
    d:DesignHeight="60"
    d:DesignWidth="350">

    <UserControl.ContextMenu>
        <ContextMenu Tag="{Binding Tag, ElementName=CategoryListItemUC}">
            <MenuItem
                Command="{Binding Path=PlacementTarget.Tag.DeleteCategoryCommand, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}"
                CommandParameter="{Binding Path=PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}"
                Header="Delete" />

        </ContextMenu>

    </UserControl.ContextMenu>

    <Button
        Command="{Binding Path=Tag.ChangeCategoryCommand, ElementName=CategoryListItemUC}"
        CommandParameter="{Binding DataContext, ElementName=CategoryListItemUC}"
        Padding="15 5 30 5">

        <Button.Style>
            <Style BasedOn="{StaticResource ButtonHoverStyle}" TargetType="Button">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type Button}">
                            <Border
                                Padding="{TemplateBinding Padding}"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4"
                                Margin="4 2">
                                <ContentPresenter HorizontalAlignment="Left" VerticalAlignment="Center" />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <DataTrigger Value="True">
                        <DataTrigger.Binding>
                            <MultiBinding>
                                <MultiBinding.Converter>
                                    <local:EqualityConverter />
                                </MultiBinding.Converter>
                                <Binding Path="Name" />
                                <Binding Path="CategoryListService.CurrentCategory" Source="{x:Static local:ViewModelLocator.Instance}" />
                            </MultiBinding>
                        </DataTrigger.Binding>
                        <Setter Property="Background" Value="{DynamicResource CategorySelectedBackgroundBrush}" />
                    </DataTrigger>
                    <!--  The mouse over trigger is the second defined one so it can highlight an already selected item also  -->
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource CategoryHoverBackgroundBrush}" />
                    </Trigger>
                </Style.Triggers>
            </Style>
        </Button.Style>

        <TextBlock
            AutomationProperties.AutomationId="CategoryListItemText"
            Grid.Column="0"
            Text="{Binding Name}"
            Style="{DynamicResource CategoryTextBlockStyle}"
            FontSize="{Binding UIScaler.FontSize.Regular, Source={x:Static local:ViewModelLocator.Instance}}" />
    </Button>

</UserControl>